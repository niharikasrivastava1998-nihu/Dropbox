<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vendor Drive Pro</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        :root { --primary: #1a73e8; --bg: #f8f9fa; --card: #ffffff; }
        body { font-family: 'Segoe UI', system-ui, sans-serif; margin: 0; background: var(--bg); padding: 20px; }
        .container { max-width: 900px; margin: 0 auto; }
        .card { background: var(--card); padding: 25px; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); margin-bottom: 20px; }
        
        /* Upload Area */
        .upload-zone { border: 2px dashed #dadce0; padding: 30px; text-align: center; border-radius: 8px; transition: 0.3s; }
        .upload-zone:hover { border-color: var(--primary); background: #f1f8ff; }
        input[type="file"] { margin-bottom: 15px; }
        
        /* Controls */
        .toolbar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .view-btns button { background: white; border: 1px solid #dadce0; padding: 8px 15px; cursor: pointer; border-radius: 5px; margin-left: 5px; }
        .view-btns button.active { background: var(--primary); color: white; border-color: var(--primary); }

        /* File Display */
        #fileContainer { display: grid; gap: 15px; }
        .view-list { grid-template-columns: 1fr; }
        .view-grid { grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); }
        .view-big { grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); }

        .file-card { background: white; border: 1px solid #eee; padding: 15px; border-radius: 8px; display: flex; align-items: center; position: relative; transition: transform 0.2s; }
        .view-grid .file-card, .view-big .file-card { flex-direction: column; text-align: center; }
        .file-card:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        
        .icon { font-size: 1.5rem; margin-right: 15px; }
        .view-grid .icon { font-size: 2.5rem; margin: 0 0 10px 0; }
        .view-big .icon { font-size: 4rem; margin: 0 0 15px 0; }
        
        .info { flex-grow: 1; overflow: hidden; }
        .name { font-weight: 600; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; display: block; }
        .date { font-size: 0.75rem; color: #70757a; }
        
        .dl-link { color: var(--primary); text-decoration: none; font-weight: bold; font-size: 0.85rem; margin-top: 10px; }
        
        /* Debug Logger */
        #debugLog { background: #202124; color: #ff5252; padding: 15px; border-radius: 8px; font-family: monospace; font-size: 0.8rem; margin-top: 20px; display: none; overflow-x: auto; }
        .btn-main { background: var(--primary); color: white; border: none; padding: 12px 24px; border-radius: 6px; font-weight: bold; cursor: pointer; }
    </style>
</head>
<body>

<div class="container">
    <div class="card">
        <div class="upload-zone">
            <h2 style="margin-top:0">ðŸ“¤ Sincere File Portal</h2>
            <input type="file" id="fileInput"><br>
            <button class="btn-main" id="uploadBtn" onclick="uploadFile()">Upload Now</button>
            <p id="status" style="margin-top:10px; font-weight:bold;"></p>
        </div>
    </div>

    <div class="toolbar">
        <h3 id="fileCount">Recent Files (0)</h3>
        <div class="view-btns">
            <button onclick="updateView('list')" id="listBtn" class="active">List</button>
            <button onclick="updateView('grid')" id="gridBtn">Small</button>
            <button onclick="updateView('big')" id="bigBtn">Large Icons</button>
        </div>
    </div>

    <div id="fileContainer" class="view-list"></div>
    
    <div id="debugLog"></div>
</div>

<script>
    // --- CONFIGURE YOUR SUPABASE HERE ---
    const SB_URL = 'https://your-vhodntvjwpdigiagllhk.supabase.co'; 
    const SB_KEY = 'vhodntvjwpdigiagllhk';
    const BUCKET_NAME = 'vendor-files'; 

    const supabase = supabase.createClient(SB_URL, SB_KEY);

    // Logger to catch errors visually on mobile/laptop
    function logError(msg) {
        const log = document.getElementById('debugLog');
        log.style.display = 'block';
        log.innerHTML += `> ${msg}<br>`;
    }

    async function listFiles() {
        const container = document.getElementById('fileContainer');
        const countHeader = document.getElementById('fileCount');
        
        const { data, error } = await supabase.storage.from(BUCKET_NAME).list('', {
            sortBy: { column: 'created_at', order: 'desc' }
        });

        if (error) {
            logError("List Error: " + error.message);
            return;
        }

        countHeader.innerText = `Recent Files (${data.length})`;
        container.innerHTML = data.length === 0 ? "No files found in bucket." : "";
        
        data.forEach(file => {
            const cleanName = file.name.includes('_') ? file.name.split('_').slice(1).join('_') : file.name;
            const date = new Date(file.created_at).toLocaleDateString();
            const publicUrl = `${SB_URL}/storage/v1/object/public/${BUCKET_NAME}/${file.name}`;
            
            const div = document.createElement('div');
            div.className = 'file-card';
            div.innerHTML = `
                <div class="icon">${getFileIcon(file.name)}</div>
                <div class="info">
                    <span class="name" title="${cleanName}">${cleanName}</span>
                    <span class="date">${date}</span><br>
                    <a href="${publicUrl}" target="_blank" class="dl-link">Download</a>
                </div>
            `;
            container.appendChild(div);
        });
    }

    async function uploadFile() {
        const input = document.getElementById('fileInput');
        const btn = document.getElementById('uploadBtn');
        const status = document.getElementById('status');
        
        if (!input.files.length) return alert("Select a file first");

        const file = input.files[0];
        btn.disabled = true;
        btn.innerText = "Working...";
        status.innerText = "Uploading to Cloud...";

        const finalPath = `${Date.now()}_${file.name}`;

        try {
            const { data, error } = await supabase.storage
                .from(BUCKET_NAME)
                .upload(finalPath, file);

            if (error) {
                logError("Upload Error: " + error.message);
                status.innerText = "âŒ Failed";
            } else {
                status.innerText = "âœ… Success!";
                input.value = '';
                listFiles();
            }
        } catch (e) {
            logError("System Exception: " + e.message);
        } finally {
            btn.disabled = false;
            btn.innerText = "Upload Now";
        }
    }

    function getFileIcon(filename) {
        const ext = filename.split('.').pop().toLowerCase();
        const map = { pdf: 'ðŸ“•', xlsx: 'ðŸ“Š', xls: 'ðŸ“Š', csv: 'ðŸ“Š', png: 'ðŸ–¼ï¸', jpg: 'ðŸ–¼ï¸', jpeg: 'ðŸ–¼ï¸', mp4: 'ðŸŽ¬', pptx: 'ðŸ“‰', docx: 'ðŸ“' };
        return map[ext] || 'ðŸ“„';
    }

    function updateView(type) {
        document.getElementById('fileContainer').className = 'view-' + type;
        document.querySelectorAll('.view-btns button').forEach(b => b.classList.remove('active'));
        document.getElementById(type + 'Btn').classList.add('active');
    }

    // Initial Load
    listFiles();
</script>

</body>
</html>
